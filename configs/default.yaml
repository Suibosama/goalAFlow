# GoalFlow Default Configuration

# ============ Data Configuration ============
data:
  # Data paths
  data_root: "./data/nuscenes"
  train_split: "train"
  val_split: "val"
  test_split: "test"

  # Sensor configuration
  image_size: [256, 256]  # H, W
  num_cameras: 3  # forward, left, right
  lidar_range: 50.0  # meters

  # Sequence configuration
  history_steps: 4  # number of historical frames
  future_steps: 30  # number of future steps to predict
  step_time: 0.5  # seconds between steps

  # Data augmentation
  augmentation:
    enabled: true
    flip_prob: 0.5
    rotation_range: 15  # degrees

# ============ Model Configuration ============
model:
  name: "GoalFlow"

  # Perception (TransFuser)
  perception:
    # Image encoder
    image_backbone: "resnet34"
    image_feature_dim: 256
    use_depth_estimation: false

    # LiDAR encoder
    lidar_backbone: "pointnet"
    lidar_feature_dim: 256
    voxel_size: [0.4, 0.4, 0.4]
    point_cloud_range: [-50, -50, -3, 50, 50, 3]

    # BEV configuration
    bev_resolution: [200, 200]  # cells
    bev_scale: 0.5  # meters per cell
    transformer_layers: 4
    num_heads: 8

  # Goal Point Module
  goal:
    # Vocabulary
    num_clusters: 256  # number of goal clusters
    cluster_method: "kmeans"

    # Scoring
    distance_bins: 50
    max_distance: 50.0
    use_dac: true  # Drivability Area Classification

    # Selection
    top_k: 10  # select top-k goals for trajectory generation

  # Planning Module
  planning:
    # Trajectory encoder
    trajectory_dim: 128
    trajectory_layers: 3

    # Rectified Flow
    flow_steps: 10  # number of flow matching steps during training
    inference_steps: 10  # number of steps during inference

    # Trajectory generation
    num_candidates: 6  # number of trajectory candidates
    trajectory_length: 30  # number of waypoints

    # Scorer weights
    lambda_progress: 1.0
    lambda_collision: 2.0
    lambda_comfort: 0.5
    lambda_distance: 0.3

# ============ Training Configuration ============
training:
  # General
  max_epochs: 100
  batch_size: 8
  learning_rate: 0.0001
  weight_decay: 0.0001
  gradient_clip: 1.0

  # Optimizer
  optimizer: "adamw"
  scheduler: "cosine"
  warmup_epochs: 5

  # Loss weights
  losses:
    perception_weight: 1.0
    goal_weight: 1.0
    planner_weight: 1.0

  # Multi-stage training
  stage: "full"  # perception | goal | planner | full
  freeze_perception: false
  freeze_goal: false

  # Logging
  log_every_n_steps: 50
  val_check_interval: 1.0  # epochs
  save_checkpoint_every_n_epochs: 5

  # Hardware
  num_workers: 4
  pin_memory: true
  accelerator: "auto"

# ============ Evaluation Configuration ============
evaluation:
  metrics:
    - "snc"  # Scene Completeness
    - "sdac"  # Drivability Area Classification
    - "sttc"  # Time to Collision
    - "scf"  # Collision Rate
    - "sep"  # Endpoint Error
    - "spdm"  # Perceptual Distance Metric

  num_samples: 1000
  save_visualizations: true
  vis_dir: "./outputs/visualizations"

# ============ Simulation (for testing) ============
simulation:
  enabled: true
  num_scenarios: 1000
  scenario_types:
    - "straight"
    - "turn_left"
    - "turn_right"
    - "lane_change"
    - "intersection"

  # Scenario generation parameters
  num_agents: 5
  agent_speed_range: [5, 15]  # m/s
  road_width: 3.5  # meters
